<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ledger Forensics ‚Äî BioSignal-AI</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; background:#f8fafc; padding:20px; }
    .card { background:#fff; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.1); padding:24px; max-width:960px; margin:0 auto; }
    h1 { color:#334155; margin-bottom:10px; }
    p { color:#475569; }
    .row { display:flex; gap:12px; margin:16px 0; flex-wrap:wrap; }
    input { flex:1; padding:10px 12px; border:1px solid #cbd5e1; border-radius:8px; }
    button { padding:10px 16px; background:#6366f1; color:#fff; border:none; border-radius:8px; cursor:pointer; font-weight:600; }
    button:hover { background:#4f46e5; }
    pre { background:#0f172a; color:#e2e8f0; padding:12px; border-radius:8px; overflow:auto; max-height:360px; }
    a { color:#2563eb; text-decoration:none; }
  </style>
  <script>
    function buildCommand(){
      const q = document.getElementById('query').value.trim();
      const cmd = q ? `python scripts/forensics/trace_ledger_event.py "${q}" --verify-hash --write-latest` : 'Enter an event ID or tag';
      document.getElementById('cmd').textContent = cmd;
    }
    async function loadLatest(){
      try{
        const resp = await fetch('../forensics/last_trace.json', {cache:'no-store'});
        if(resp.ok){ const j = await resp.json(); document.getElementById('output').textContent = JSON.stringify(j, null, 2); }
        else { document.getElementById('output').textContent = 'No recent trace available. Run the command locally and refresh.'; }
      }catch(e){ document.getElementById('output').textContent = 'Unable to load last trace.'; }
    }
    document.addEventListener('DOMContentLoaded', ()=>{ buildCommand(); loadLatest(); setInterval(loadLatest, 600000); });
  </script>
 </head>
 <body>
  <div class="card">
    <h1>üîé Ledger Forensics</h1>
    <p>Search historical snapshots for an event or tag. Run the command locally to generate an auditable report. The latest trace (if generated with <code>--write-latest</code>) is displayed below.</p>
    <div class="row">
      <input id="query" placeholder="Event ID or tag (e.g., v1.8.0-trust-ledger)" oninput="buildCommand()" />
      <button onclick="buildCommand()">Build Command</button>
      <a href="index.html" style="align-self:center">‚Üê Back to Portal</a>
    </div>
    <p>Run:</p>
    <pre id="cmd"></pre>
    <p>Latest Trace Output:</p>
    <pre id="output">Loading‚Ä¶</pre>
  </div>
 </body>
 </html>
