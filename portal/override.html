<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Emergency Override Control</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; background:#111; color:#eee; margin:0; padding:20px; }
    .banner { padding:15px; border-radius:8px; margin-bottom:20px; font-weight:600; text-align:center; }
    .active { background:#dc2626; color:#fff; }
    .inactive { background:#059669; color:#fff; }
    button { padding:10px 18px; margin:5px; border:none; border-radius:6px; font-weight:600; cursor:pointer; }
    .btn-activate { background:#dc2626; color:#fff; }
    .btn-deactivate { background:#059669; color:#fff; }
    .status-box { background:#1f2937; padding:15px; border-radius:8px; margin-top:10px; }
    code { background:#1f2937; padding:2px 4px; border-radius:4px; }
  </style>
</head>
<body>
  <h1>ðŸ›‘ Emergency Override</h1>
  <div id="override-banner" class="banner inactive">System Autonomous</div>
  <div>
    <input id="reason" placeholder="Activation reason" style="padding:8px; width:300px;" />
    <button class="btn-activate" onclick="activateOverride()">Activate Override</button>
    <button class="btn-deactivate" onclick="deactivateOverride()">Deactivate Override</button>
  </div>
  <div class="status-box">
    <p><strong>Active:</strong> <span id="ov-active">false</span></p>
    <p><strong>Last Activation:</strong> <span id="ov-activated">â€”</span></p>
    <p><strong>Last Deactivation:</strong> <span id="ov-deactivated">â€”</span></p>
    <p><strong>Reason:</strong> <span id="ov-reason">â€”</span></p>
  </div>

  <script>
    async function fetchStatus(){
      try {
        const r = await fetch('/override/status', {cache:'no-store'});
        if(!r.ok) return;
        const j = await r.json();
        const active = !!j.active;
        document.getElementById('ov-active').textContent = active;
        document.getElementById('ov-reason').textContent = j.reason || 'â€”';
        if(j.activated_at) document.getElementById('ov-activated').textContent = j.activated_at;
        if(j.deactivated_at) document.getElementById('ov-deactivated').textContent = j.deactivated_at;
        const banner = document.getElementById('override-banner');
        if(active){ banner.textContent='Emergency Override ACTIVE'; banner.className='banner active'; }
        else { banner.textContent='System Autonomous'; banner.className='banner inactive'; }
      } catch(e){ console.warn('Status fetch failed', e); }
    }

    async function activateOverride(){
      const reason = document.getElementById('reason').value || 'unspecified';
      try {
        const r = await fetch('/override/activate', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({reason})});
        if(r.ok){ await fetchStatus(); }
      } catch(e){ alert('Activation failed'); }
    }

    async function deactivateOverride(){
      try {
        const r = await fetch('/override/deactivate', {method:'POST'});
        if(r.ok){ await fetchStatus(); }
      } catch(e){ alert('Deactivation failed'); }
    }

    fetchStatus();
    setInterval(fetchStatus, 8000); // Auto-refresh every 8 seconds
  </script>
</body>
</html>
